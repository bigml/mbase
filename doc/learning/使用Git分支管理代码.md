## 使用Git分支管理代码

### 1. 什么时后需要用到代码分支？

1. 不是多个人就要使用多个分支

2. 代码是项目，或者产品的体现，多个分支对应的应该是项目交付给不同的客户或者不同使用
   场景，而不是针对每个开发人员。

3. 有时候有些临时加入或者开发质量不太稳定的开发人员，我们不希望他们把代码直接提交到
   待发布的分支版本上，所以会让这些开发人员使用临时，或者以各自名字命名的分支代码。
   往往这些代码被合并到对外发布的分支的可能性较小。

4. 为什么被合并的可能性比较小？因为分支的合并是两个分支的整体合并，并不能指定合并某
   个分支的某几次commit。所以对于开发质量不稳定的开发人员的分支代码，项目管理员不会
   采取合并其分支的方式吸纳其代码贡献，对于开发质量比较稳定的开发人员，公司内部、
   为图省事，管理人员一般会给予其直接push发布分支的权限（除非管理人员希望对每次合并
   的每行代码都仔细核对）。

5. 综上，分支一般用来给不太熟练的开发临时玩玩，或者用来承载同一个项目的不同的场景实
   现。后者也是本文想探讨的主要内容，除非特别说明，以下的所有 *分支* 仅指这些针对项
   目的特定版本和场景的分支。


### 2. 尽可能少的创建分支

创建一个分支，意味着管理人员需要对这个分支的代码进行长期的维护，直到这个分支被销毁。
所以管理人员对于分支的创建需要慎重考虑。创建前先确定几个事情：

1. 这个分支是不是有存在的必要？换句话说，产品提出的这个功能是不是合理？因为这个功能
   的代码没法共存于已有的代码分支里面，导致我必须要新建一个分支来实现他。

2. 这个分支是不是真有存在的必要？我能不能在已有代码分支里面通过添加配置文件配置项，
   或者增加设备类型的方式来实现产品的这个变态功能需求。

3. 这个分支大概会存在多久？哪些场景使用到了它（需要有明确的文档记录）。


### 3. 分支和版本的关系

1. 不是发布一个版本就应该创建一个分支

前面已经明确了分支的使用场合，所以，对于代码的大部分版本发布和管理，我们不应使用分支来实现。

- a. 版本仅仅用来标记代码在某个时间点的状态，比如我们在2023年2月13日发布了桥梁后台的2.1
版本。那一刻的代码，我们应该用一个版本号来对这些代码进行冻结，对外发布和运行。在那
些代码被发现了bug的情况下，我们要能迅速的拿回当时冻结的代码，进行bug修复，测试后再
次对外发布。修复的代码，可以提交到当前分支，也可以stash暂存起来，或者丢弃。

- b. 还有一种情况，产品功能或技术架构发生了重大变化，原来的代码和新版本的代码会有巨大差
异，此时我们可以新建一个分支来开发新版本的代码，同时，老版本的代码，可以在原来的分
支上继续进行维护。

情况a时，版本适合用 tag 来管理，情况b时，版本适合用 branch 来管理。所以，我们发现，
git里面并没有专门针对版本的命令。


### 4. 如何使用分支

git 里面使用分支非常轻便，数毫秒内就能完成（就是更改本地一个文件里面的一行文本内容）。

- git branch -av 可以查看当前仓库下所有的分支（包括远端分支）

- git branch newframe master 以当前 master 代码为基础，创建一个新的名为 newframe 的分支

- git checkout newframe 将工作目录下的代码切换到 newframe 分支下

- git merge master 将 master 分支的代码合并到当前分支下

- git branch -d newframe 删除 newframe 分支

- git log master..newframe 查看在 newframe 分支上有, 在 master 分支上没有的提交

- git diff master..newframe 查看 newframe 相对 master 代码做了哪些修改

- git diff newframe..master 查看 master 相对 newframe 代码做了哪些修改